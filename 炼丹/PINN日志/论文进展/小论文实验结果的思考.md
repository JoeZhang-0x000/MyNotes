目前有结果的实验有六个，对每一个都将其成分的MIC值做了一个表格，以及使用渐进强调算法进行训练后的结果与原始的训练结果对比。这里所有的都是默认先强调主干项，忽视次要项进行的训练，如果有必要，需要补做相反的训练的结果，即先强调次要项，忽视主干项。但是我感觉反着的实验似乎只需要一组就够了，因为它效果不好，并且是违背直觉的。
## 渐进思想
我们认为PDE的表达式中的各个项对PDE解的影响程度并不一致，有些项对结果影响大，有些项对结果影响小。如果能将对结果影响大的项和对结果影响小的项找出来，有针对的进行训练，从直觉上应该是可以提高PDE求解精度以及收敛速度的。
当我们找出了PDE中对结果影响的占优项 (重要项)，和占劣项 (次要项)，可以采用目前讨论的渐近算法进行训练。
例如
$$
\begin{aligned}
\mathcal{N}(u;u_{x})+\mathcal{M}(u;u_{x)}=0\cr
\text{其中}\mathcal{N}(\cdot)\text{是占优项，}\mathcal{M}(\cdot)\text{是占劣项}
\end{aligned}
$$
在训练时候就可以变形为：
$$
\mathcal{N}(u;u_x)+\lambda\mathcal{M}(u;u_x)=0,\qquad \lambda \in [0,1]
$$
表示对占劣项$\mathcal{M}$进行了渐进训练。其实我更关注的是占劣项，而不是占优项。因为我就是要有选择性的忽略对解的影响不大的项。
我也尝试过其他的一些变形，例如:
$$
(2-\lambda)\mathcal{N}(u;u_x)+\lambda\mathcal{M}(u;u_x)=0,\qquad \lambda \in [0,1]
$$
这个式子相对于上面的式子看起来更加封闭一些，但是实际的效果确实不如上一个。我想，应该是下面的式子改变了原本方程中占优项的贡献。
# 实验结果
## 连续函数拟合
$$
u = (x^{3}- x)\frac{sin(7\sin x)}{7}+\sin(12x),\qquad x\in[-3,3]
$$

| 成分                               | MIC值 |
| ---------------------------------- | ----- |
| $(x^{3}- x)\frac{sin(7\sin x)}{7}$ | 0.46  |
| $\sin(12x)$                        | 0.63  |
因此选择给前者加了一个系数，从0到1，即先削弱了前者的训练。结果如下图所示，上边是原始的，下面是使用渐进算法后的，左边是原象的差异，右边是频谱图中的差异。很明显，下边的那幅图收敛的速度快很多。
![[Pasted image 20231009230536.png|Neural network solution trained by the original method(top row) and the proposed method(bottom row). The left column shows the solution, while the right column shows the solution in the frequency domain.]]
## 不连续函数拟合
$$
u_2 = \left \{
    \begin{aligned}
        sin(6x)+7sin(x),& x < 0 \\
        1+cos(12x)+cos(x),& x > 0
	\end{aligned}
    \right.
$$

| 成分         | MIC  |
| ------------ | ---- |
|x<0部分|
| $\sin(6x)$   | 1.0  |
| $7\sin(x)$   | 0.35 |
|x>0部分|
| 1            | 0.0  |
| $x\cos(12x)$ | 0.92 |
| $\cos(x)$             |      0.63|
这里是讲x<0和x>0左右两边分别拆开了。大概可以看出来，对于x<0的部分，$\sin(6x)$明显占优，对于x>0的部分，$x\cos(12x)$占优。
于是类似的，在占劣的项前面加了一个0->1之间逐渐升高的系数，得到结果如下：
![[Pasted image 20231009231259.png|Neural network solution trained by the original method(top row) and the proposed method(bottom row). The left column shows the solution, while the right column shows the solution in the frequency domain]]
## Burgers eq
$$
u_{t}+uu_{x}=\nu u_{xx}
$$

| 成分     | MIC  |
| -------- | ---- |
| $u_t$    | 0.68 |
| $uu_{x}$ | 0.69 |
| $u_{xx}$ | 0.27 | 
在这个例子中，$u_{t}，u_{xx}$的MIC值差不多相等，所以将其划分为一项，作为主干，$u_{xx}$ 的MIC值明显占劣，所以作为次要项。我给了$u_{xx}$一个从0->1的渐进系数，大概如下图右边所示 (蓝色渐进系数不变，代表对照组，橙色是线性增大，绿色是指数增大)
采用强调占优项的训练策略，得到的结果如下图所示。
![[Pasted image 20231009231755.png|这张图左边是三种不同渐进系数下的结果，右边对应的是渐进系数的变化过程。图中绿色和橙色线条；蓝色是对照组；可以看到使用了渐进策略L2误差明显下降的更快，并且收敛值更低。]]
具体的云图如下所示：
![[Pasted image 20231009235820.png|第一行是解的预测的结果，第二行是误差；第一列对应上图的对照组 (上图蓝色曲线)，第二列对应线性渐进 (橙色曲线)，第三列对应指数渐进 (绿色曲线)。第二列误差云图中，颜色越红代表越大，这里的误差主要体现在激波面附近。]]
## Allen-Cahn eq
$$
u_{t}=u_{xx}+5(u-u^3)
$$

| 成分     | MIC |
| -------- | --- |
| $u_{t}$  |     1.00|
| $u_{xx}$ |     0.73|
| $u-u^{3}$         | 1.00    |
这里其实就没有明显的占优项了，这个实验可能需要重新换一个，因为结果也不是太明显。在之前的实验中，我是给了$u_{xx}$一个从0->1的渐进系数，大概如下图左边所示 (蓝色渐进系数不变，代表对照组，橙色是线性增大，绿色是指数增大)。
![[Pasted image 20231009232352.png|左边是渐进系数的变化；右边是不同超参数下的L2的误差值；含有超参数组 (橙色和绿色) 的L2误差下降的更快，收敛值更低，虽然图中不太明显了，可能是这个案例没选好。]]
详细的云图如下所示：
![[Pasted image 20231009235334.png|第一行是解的预测的结果，第二行是误差；第一列对应上图的对照组 (上图蓝色曲线)，第二列对应线性渐进 (橙色曲线)，第三列对应指数渐进 (绿色曲线)。第二列误差云图中，颜色越红代表越大，这幅图中误差主要出现在靠近右侧区域。]]
## Klein-Gordon eq
$$
u_{tt}-u_{xx}+u^{2}=-x\cos(t)+x^{2}\cos^{2}(t)
$$

| 成分                | MIC  |
| ------------------- | ---- |
| $u_{tt}$            | 1.00 |
| $u_{xx}$            | 0.27 |
| $u^2$               | 1.00 |
| $x\cos(t)$          | 1.00 |
| $x^{2}\cos ^{2}(t)$ | 1.00 | 
这里明显是$u_{xx}$占劣，所以训练的时候给它加了一个0->1的渐进系数。结果如下：
![[Pasted image 20231009233225.png|左边是渐进系数的变换趋势；右边是对应的L2误差变化。可以看到使用了渐进训练策略的组收敛更快，且收敛值更低 (橙色和绿色)。]]
值得一提的是这个案例的图片效果看起来还蛮可以，如下图所示。
![[Pasted image 20231009233713.png|第一行是解的预测的结果，第二行是误差；第一列对应上图的对照组 (上图蓝色曲线)，第二列对应线性渐进 (橙色曲线)，第三列对应指数渐进 (绿色曲线)。第二列误差云图中，颜色越红代表越大，可以明显发现对照组的误差大于其他两组，这说明我的方法具有效果。]]
## Lid-driven cavity
$$
\vec{V}\cdot\nabla \vec{V}=\mu\nabla\cdot\nabla \vec{V}-\nabla P
$$
相对于u分量和v分量的值分别进行了分析 (下面的表格中每一行是该成分相对于分量的MIC值，例如第一行就是 MIC($uu_x+vu_x,u$))，常数项不影响MIC值，所以可以忽略.

| 成分            | MIC  | 分量 |
| --------------- | ---- | ---- |
|x方向分量|
| $uu_x+vu_x$     | 0.31 |      $u$|
| $u_{xx}+u_{yy}$ | 0.56 |      $u$|
| $p_x$           | 0.25 |   $u$   |
|$uu_{x}+vu_{x}+p_{x}$|0.34|$u$|
|y方向分量|
| $uv_x+vv_x$     | 0.32 |      $v$|
| $v_{xx}+v_{yy}$ | 0.20 |      $v$|
| $p_y$           | 0.30 |   $v$   |
这里其实也没有绝对占优，相对而言扩散项占优。这个案例中，给了对流和压力梯度项渐进因子，其从0->1逐渐变化，不再赘述，结果如下：

![[Pasted image 20231009234614.png|蓝色的是对照组，橙色和绿色的是实验组；从结果看，橙色和绿色的L2误差下降的更快，且收敛值更低。|500]]
速度云图如下图所示，
![[Pasted image 20231009234827.png|速度云图 (模)，第一行是解的预测的结果，第二行是误差；第一列对应上图的对照组 (上图蓝色曲线)，第二列对应线性渐进 (橙色曲线)，第三列对应指数渐进 (绿色曲线)。从结果上看，使用了渐进训练策略之后，边角处的预测结果确实有了明显的改善 (对照组红色区域明显更多)。]]

注意，在这个案例中根据MIC值，PDE沿着y方向分量的MIC值并无明显占优项，或许不应该使用渐进策略，即应当只对PDE沿着x方向的分量中的对流项和压力梯度采用渐进。🤔
# 思考
## 实验结果的思考
通过上述的已有实验结果展示，可以看出，如果一个方程具有MIC值明显占优的项或者明显占劣的项，则通过渐进训练策略，可以取得良好的精度提升效果。至于收敛的速度，似乎与渐进系数的变化方式有关，综合而言，目前认为线性的渐进关系收敛速度和精度上都是比较好的。
对于MIC值无明显占优项或占劣的方程，这种渐进训练策略起的作用比较小。换句话说，这种渐进训练策略的效果，受到MIC值的影响，MIC值强占劣的方程，使用这种策略会得到更好的结果，MIC值相差不大的方程则收益甚小。
现阶段的启发是，应该构造几个具有具有强MIC占劣项的方程，然后作为案例。然而这也是一个难点。前阶段之所以选择以上案例是以上案例中的方程具有公开数据集，因为LuLu等人的论文中公开了数据，选择其他的方程，没有一个比较好的数据集。目前阶段来看，一个暑假的调参对于某些MIC无明显占劣项PDE的提升甚微，调参可能不是一个好的路线，反而如果别人调不出来相同的结果还可能会怀疑论文数据的真实性。所以当下提升论文结果的最有效方法是构造新的数据集。

## MIC以及占劣的思考

为什么当时选择了最大信息系数，因为有一个表格总结了常见的信息度量方式，其中不难发现MIC具备很好的特性。使用不同的度量方法对同一个PDE的解计算的相关性大小是有所差异的，然而PDE的占劣项也没一个比较明确的评价指标，所以我并没有尝试用其他的度量方法 (简单线性度量方法尝试过，计算不出PDE的复杂非线性关系，得出全都是0，故这里讨论的度量方法只包含非线性度量)。选择MIC主要是因为他的综合指标是最好的。
![[Pasted image 20231010083613.png]]
MIC的计算公式如下所示：
![[Pasted image 20231010084520.png]]
但是实现时，我是直接调库MINE.compute(x, y). 
基于一些先验知识，我们认为PDE中的占优项具有如下的一到多种特征:
1. 该项的系数绝对值较大；
2. 该项的导数或者阶数较高；
3. 某些物理直觉；
例如对于“连续函数拟合”案例中，式子$(x^{3}- x)\frac{sin(7\sin x)}{7}$由于系数绝对值较小，所以应当是占劣的。计算得到的MIC值反应的结果与我们的猜测一致。
再例如,"burgers eq"案例中，由于在物理意义中，该方程描述的就是激波的传播，所以一定是对流项占优，扩散项和时间梯度项占劣的，我们计算得到的MIC反应的结果也反应了相似的结论。
但是有一些比较复杂的方程，例如"allen-cahn eq"，我们并未发现明显占劣项或占优项。其MIC值都比较大，所以施加了渐进算法后，提升并不明显。

补充一下，最开始我认为占劣的判断就是简单的比大小。
对于一个一般的PDE，若将其拆分成两项:
$$
\mathcal{N}(u;u_{x};\cdots)+\mathcal{M}(u;u_{x};\cdots)=0
$$
这里的$\mathcal{N},\mathcal{M}$都是偏微分算子，代表某种非线性运算，例如求导，求幂等等。如果我们定义算子$\mathcal{M}$相对于算子$\mathcal{N}$占劣，当满足，
$$
MIC(\mathcal{N},u)>MIC(\mathcal{M},u)
$$
即算子$\mathcal{N}$与方程解$u$的相关程度大于算子$\mathcal{M}$，那么$\mathcal{M}$就是占劣的。
但是，经过实验可以看出来 ，占优和占劣不应该是简单比大小，而应该与具体的MIC值有关系。举个例子，在"allen-cahn eq"的实验中，方程中每一项的值都比较大，都超过了0.7，应当说明这每一项都与解之间有着较强的相关程度，此时我将其中最差的一项看作占劣项进行了训练，得到的效果提升非常小。再例如，"Klein-Gordon eq"的实验中，其他几项的MIC值都是接近1，而只有$u_{xx}$的MIC值是0.27，这一个是很明显的占劣项，所以我可以对其进行渐进训练，结果改善就非常明显。

通过两个例子的对比，我发现寻找占劣项并不能简单与寻找MIC最小项划等。至少应该有以下的要求：
1. MIC占劣的项必须是低相关性的项；
2. MIC占优的项必须是高相关的项；
3. 将低相关性的项划分为占劣项的影响不太大；
4. 将高相关性项划分到占劣项可能对方程求解影响较大；
5. 

我们要找的是占劣项，就是要小于其他项，但是必须让高相关性项尽量不容易被划到占劣项，于是就已经不能简单的进行线性的比较了，必须先用一个S形曲线将MIC值映射，然后比大小。这样可以规避掉两端的影响，当MIC值特别大或者特别小的时候会出现饱和现象。
我定义的S形曲线如下所示：
$$
sig(x) = \frac{x^k}{x^k+e^{(1-x^k)}}
$$
当k=10，曲线如图所示：
![[Pasted image 20231010113946.png|k=10的sig(x)，图中具有饱和区|500]]

于是，PDE中的某个项强占劣，当满足：
$$
\frac{1}{sig(MIC(\mathcal{N}_{i},u))} \le \sum_{j\ne i}\frac{1}{sig(MIC(\mathcal{N_j},u))}
$$
这里取了调和数，因为我们要找的是强占劣的项，最理想的情况应该是
$$
MIC(\mathcal{N}_{i}) \ll MIC(\mathcal{N}_{j}),\qquad \forall j\ne i
$$
所以左端的倒数一定是相当大的，大于右边所有项的调和数相加的和。这样的定义之后可以有效的降低将MIC值较高的项划分为占劣项的风险。例如某个方程的三项算出来的MIC值分别为(0.9,0.99,0.999)，则这里的0.9这一项相关性很高，如果将其划分为占劣项进行了渐进训练，将会对结果产生负面影响；但是如果对于MIC值分别为(0.1,0.9,0.9)的三个项进行分析，那么将MIC值为0.1的项划为强占劣项是很理想的情况，实际上这样划分也会起到很可观的效果；再例如将(0.2,0.3,0.3)这三项进行了划分，虽然根据上面的不等式，可以计算出0.2的项可能会占劣，但是不用担心，因为这三项本身就是相关性较弱的，渐进掉一个对结果的影响并不大。我们主要担心的是将相关性较高的项给划分为占劣项然后渐进掉了。

以下是使用新的判别标准后，前一节的实验中的占劣项的重新划分。
1. 连续函数拟合问题

| 成分                               | MIC值 |1/sig(MIC)|
| ---------------------------------- | ----- |---|
| $(x^{3}- x)\frac{sin(7\sin x)}{7}$ | 0.46  |2.49|
| $\sin(12x)$                        | 0.63  |1.27|
可以看到，$2.49 > 1.27$故$(x^{3}- x)\frac{sin(7\sin x)}{7}$项占劣；

2. 不连续函数拟合问题
   
| 成分         | MIC  |1/sig(MIC)|
| ------------ | ---- |----|
|x<0部分|
| $\sin(6x)$   | 1.0  |1.01|
| $7\sin(x)$   | 0.35 |5.48|
|x>0部分|
| 1            | 0.0  |
| $x\cos(12x)$ | 0.92 |1.01|
| $\cos(x)$             |      0.63|1.27|
可以看到对于x<0部分明显的占劣部分是$7\sin(x)$，对于x>0部分占劣部分是$\cos(x)$，其实这里差距不是那么明显了，没有数量级上的差异，所以也就导致了训练出来的提升看起来不是很大。
3. Burgers

| 成分     | MIC  |1/sig(MIC)|
| -------- | ---- |---|
| $u_t$    | 0.68 |1.17|
| $uu_{x}$ | 0.69 |1.15|
| $u_{xx}$ | 0.27 | 10.97|
这里具有明显的占劣项,$10.97 > 1.17+1.15$，$u_{xx}$强占劣，因此对于提升来说是较为可观的。

4. Allen-Cahn
   
| 成分     | MIC |1/sig(MIC)|
| -------- | --- |---|
| $u_{t}$  |     1.00|1.07|
| $u_{xx}$ |     0.73|1.10|
| $u-u^{3}$         | 1.00    |1.07|
这里$1.10 \ngtr 1.07 + 1.07$，因此没有明显占劣的项，对其进行渐进算法的效果并不理想。
5. Klein-Gordon

| 成分                | MIC  |1/sig(MIC)|
| ------------------- | ---- |---|
| $u_{tt}$            | 1.00 |1.01|
| $u_{xx}$            | 0.27 |10.97|
| $u^2$               | 1.00 |1.01|
| $x\cos(t)$          | 1.00 |1.01|
| $x^{2}\cos ^{2}(t)$ | 1.00 | 1.01|
因为$10.97 > 1.01 + 1.01 +1.01 +1.01$，所以$u_{xx}$项是强占劣的，最终我们的结果也证明其效果显著。

6. Cavity

| 成分            | MIC  | 分量 |1/sig(MIC)|
| --------------- | ---- | ---- |---|
|x方向分量|
| $uu_x+vu_x$     | 0.31 |      $u$|1.55|
| $u_{xx}+u_{yy}$ | 0.56 |      $u$|13.18|
| $p_x$           | 0.25 |   $u$   |7.69|
|$uu_{x}+vu_{x}+p_{x}$|0.34|$u$|5.95|
|y方向分量|
| $uv_x+vv_x$     | 0.32 |      $v$|7.05|
| $v_{xx}+v_{yy}$ | 0.20 |      $v$|21.09|
| $p_y$           | 0.30 |   $v$   |8.39|
在x方向上，如果将压力梯度和对流项分开看，则$13.18 > 7.69 + 1.55$ 因此扩散项强占劣，如果将压力梯度和对流项放在一起，则其MIC为0.34，也是扩撒项强占劣。
在y方向上，$21.09 > 7.05+8.39$扩散项也是强占劣。

## MIC占劣评估的思考
按照上一节中的方法计算$1/sig(MIC)$，进而判断是否强占优，可能具有一定的道理，可以与实验结果 (使用渐进算法后的提升效果) 对应。一般来说，存在强占劣，且数量级相差越大的效果越明显。至于Alen-Chan方程虽然看起来存在占劣项，但是经过计算发现并不是占劣的，所以提升较小，这种可以起个名字叫伪占劣？
我认为这种评估方法具备一定的实际意义，虽然形式有点古怪，而且是拍脑袋想出来的。不失一般性的，如果要在论文中写，或许可以叙述为，我们利用了一种评估指标$g(\cdot)$对MIC值进行一个映射 (如果不进行映射难以区分某些特殊情况，例如 Klein-Gordon方程的情况，我们认为他是伪占劣的，因为每一项都很重要，不能简单的忽略重要性相对较小的项；但是如果每一项重要性都不高，其实我们忽略了其中一两项反而影响不大)，再来进行评估，这样的评估效果更好。进一步的，指出我们采用的$g(\cdot)=\frac{1}{sig(\cdot)}$，然后效果还可以。
如果将这种判别方法写进论文中，是否也算一种创新。🤔